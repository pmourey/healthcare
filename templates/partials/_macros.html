{# Définir la macro check_threshold au début du template #}
{% macro check_threshold(value, min_val, max_val) %}
    {% if value is not none and (value < min_val or value > max_val) %}
        class="text-danger fw-bold" title="Valeur hors limites (normale: {{ min_val }} - {{ max_val }})"
    {% endif %}
{% endmacro %}

{% macro display_value(data, field) %}
    <td {{ check_threshold(data[field], thresholds[field].min, thresholds[field].max) }}>
        {{ data[field] }}{% if data[field] is not none %} {{ thresholds[field].unit }}{% endif %}
    </td>
{% endmacro %}

{# Définir les seuils #}
{% set thresholds = {
    'hemoglobine': {'min': 13.0, 'max': 18.0, 'unit': 'g/dL'},
    'hematocrite': {'min': 37.0, 'max': 50.0, 'unit': '%'},
    'globules_blancs': {'min': 4000, 'max': 11000, 'unit': '/mm³'},
    'globules_rouges': {'min': 4.6e6, 'max': 6.2e6, 'unit': '/mm³'},
    'plaquettes': {'min': 150000, 'max': 400000, 'unit': '/mm³'},
    'creatinine': {'min': 7.2, 'max': 11.8, 'unit': 'mg/L'},
    'uree': {'min': 35, 'max': 72, 'unit': 'mg/L'},
    'glycemie': {'min': 0.74, 'max': 1.06, 'unit': 'g/L'},
    'cholesterol_total': {'min': 0, 'max': 2, 'unit': 'g/L'},
    'hdl': {'min': 0.4, 'max': 0.6, 'unit': 'g/L'},
    'ldl': {'min': 0, 'max': 1.30, 'unit': 'g/L'},
    'triglycerides': {'min': 0, 'max': 1.5, 'unit': 'g/L'},
    'tsh': {'min': 0.38, 'max': 5.33, 'unit': 'mUI/L'},
    'psa': {'min': 0, 'max': 4.0, 'unit': 'ng/mL'},
    'alt': {'min': 7, 'max': 50, 'unit': 'UI/L'},
    'ast': {'min': 8, 'max': 50, 'unit': 'UI/L'},
    'fer': {'min': 60, 'max': 170, 'unit': 'µg/dL'},
    'vitamine_d': {'min': 30, 'max': 100, 'unit': 'ng/mL'}
} %}