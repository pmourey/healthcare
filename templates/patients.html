{% extends 'base.html' %}
{% include './partials/_menu.html' %}

{% block main %}
<div class="container-fluid py-4">
    {% if patients %}
    <h2 class="text-center mb-4">Patients du Dr {{ user.username }}</h2>

    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Actions</th>
                    <th>Nom</th>
                    <th>Contact</th>
                    <th>Date création</th>
                </tr>
            </thead>
            <tbody>
                {% for patient in patients %}
                <tr>
                    <td>
                        <div class="dropdown">
                            <button class="btn btn-outline-primary btn-sm dropdown-toggle"
                                    data-bs-toggle="dropdown">
                                Actions
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{{ url_for('show_health_data', id=patient.id) }}">
                                    <i class="bi bi-journal-medical"></i> Visites
                                </a></li>
                                <li><a class="dropdown-item" href="{{ url_for('show_blood_data', id=patient.id) }}">
                                    <i class="bi bi-droplet"></i> Analyses
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('new_health_data', id=patient.id) }}">
                                    <i class="bi bi-plus-circle"></i> Nouvelle visite
                                </a></li>
                                <li><a class="dropdown-item" href="{{ url_for('new_blood_data', id=patient.id) }}">
                                    <i class="bi bi-plus-circle"></i> Nouvelle analyse
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('select_markers', id=patient.id) }}">
                                    <i class="bi bi-graph-up"></i> Graphiques
                                </a></li>
                            </ul>
                        </div>
                    </td>
                    <td>
                        {{ patient.first_name }} {{ patient.last_name }}
                    </td>
                    <td>
                        <a href="mailto:{{ patient.email }}" class="text-decoration-none me-3">
                            <i class="bi bi-envelope"></i> {{ patient.email }}
                        </a>
                        <a href="tel:{{ patient.phone }}" class="text-decoration-none">
                            <i class="bi bi-telephone"></i> {{ patient.phone }}
                        </a>
                    </td>
                    <td>{{patient.creation_date.strftime('%d/%m/%Y')}}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info text-center" role="alert">
        Aucun patient défini pour le Dr {{ user.username }}
    </div>
    {% endif %}
</div>
{% endblock main %}
